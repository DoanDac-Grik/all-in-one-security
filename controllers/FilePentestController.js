const virusTotalHelper = require('../helpers/virusTotalHelper');
class FilePentestController {
    //[GET] /
    showFilePentest(req, res, next) {
        res.render('Pentest/file', {
            'title': 'Scan file',
            'css': 'file'
        });
    }
    //[POST] /submit-hash
    submitHash(req, res, next) {
        console.log(req.body.hash);
        res.redirect(`scan-result?hash=${req.body.hash}`);
    }
    //[GET] /scan-result
    fileScan(req,res,next){
        let hash = req.query.hash;
        // hash = '178ba564b39bd07577e974a9b677dfd86ffa1f1d0299dfd958eb883c5ef6c3e1';
        const options = {
            method: 'GET',
            headers: {
                Accept: 'application/json',
                'x-apikey': '8636535d7444c09c95dd52f6854cb623e1c86b83cfe816726b1df1968e67557b'
            }
        };
        virusTotalHelper.checkFile(hash,options)
        .then( ok => {
            //const result =ok.data.data[0].attributes.popular_threat_classification;
            const result = ok.data.data[0].attributes;

            // res.send(result);
            res.render('ResultPentest/file-scan', {
                'title': 'Scan file report',
                'css': 'result-file-scan',
                result
            })
        })
    }

    scanFileResult(req, res, next) {
        res.render('ResultPentest/file-scan-copy', {
            'title': 'Scan file report',
            'css': 'result-file-scan'
        });
    }
}
module.exports = new FilePentestController();