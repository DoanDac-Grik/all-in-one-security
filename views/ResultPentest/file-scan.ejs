<%- contentFor('body') %>
<div>
    <div class="main__container container">
        <div class="main__header">
            <p class="main__heading">Report File Scan</p>
        </div>
    
        <div class="main__file-info-scan-number-container">
            <div class="main__file-scan-number">
                <div class="file-scan__number-icon-container">
                    <i class="fas fa-exclamation result-scan-icon"></i>
                    <!-- <i class="fas fa-check-double result-scan-icon success"></i> -->
                </div>
                <div>
                    <p class="result-scan-number"><span class="number-scan">15</span>/68</p>
                </div>
            </div>
            <div class="main__file-info-wrapper">
                <div class="file-info-container">
                    <div class="file-common-scan-container">
                        <div class="file-common-scan-icon-container">
                            <!-- <i class="fas fa-check common-scan-icon success-alt"></i> -->
                            <i class="fas fa-exclamation common-scan-icon"></i>
                        </div>
                        <p class="file-common-scan-text">15 security vendors</p>
                    </div>
                    <div class="file-info">
                        <div class="file-hash-name">
                            <p class="hash-text">178ba564b39bd07577e974a9b677dfd86ffa1f1d0299dfd958eb883c5ef6c3e1</p>
                            <p class="file-name-label">File name: <span class="file-name">npkpdb.dll</span></p>
                        </div>
                        <div class="file-size">
                            <p class="file-size-number">208.00 KB</p>
                            <p class="file-size-label">Size</p>
                        </div>
                        <div class="file-upload">
                            <p class="file-upload-text"></p>
                            <p class="file-upload-label">Upload time</p>
                        </div>
                    </div>

                    <div class="tag-container">
                        <ul class="tag-list">
                            <li class="tag-item">
                                <p class="tag">detect-debug-environment</p>
                            </li>
                            <li class="tag-item">
                                <p class="tag">direct-cpu-clock-access</p>
                            </li>
                            <li class="tag-item">
                                <p class="tag">invalid-rich-pe-checksum</p>
                            </li>
                        </ul>
                    </div>
                </div>
                
            </div>
        </div>
    
        <div class="main__file-scan-result-container">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Detection</button>
                    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Details</button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                    <table class="table table-scan-file-result">
                        <tr>
                            <td class="service-result__wrapper">
                                <div class="service-result__container">
                                    <p class="service-text" id="service-text">TrendMicro-HouseCall</p>
                                    <div class="result-serivce">
                                        <!-- <i class="fas fa-check common-scan-icon success-alt"></i> -->
                                        <i class="fas fa-exclamation common-scan-icon"></i>
                                        <p title="Trojan.GenericKD.33715435" class="result-service-text">Trojan.GenericKD.33715435</p>
                                    </div>
                                </div>
                                <div class="service-result__container">
                                    <p class="service-text">AhnLab-V3</p>
                                    <div class="result-serivce">
                                        <!-- <i class="fas fa-check common-scan-icon success-alt"></i> -->
                                        <i class="fas fa-exclamation common-scan-icon"></i>
                                        <p title="Malware/Win32.Generic.C4094147" class="result-service-text">Malware/Win32.Generic.C4094147</p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="service-result__wrapper">
                                <div class="service-result__container">
                                    <p class="service-text">AhnLab-V3</p>
                                    <div class="result-serivce" title="Unable to process file type">
                                        <!-- <i class="fas fa-check common-scan-icon success-alt"></i> -->
                                        <!-- <i class="fas fa-exclamation common-scan-icon"></i> -->
                                        <i class="far fa-eye-slash common-scan-icon unable-process"></i>
                                        <p class="result-service-text unable-process-text">Unable to process file type</p>
                                    </div>
                                </div>
                                <div class="service-result__container">
                                    <p class="service-text">McAfee-GW-Edition</p>
                                    <div class="result-serivce">
                                        <i class="fas fa-check common-scan-icon success-alt"></i>
                                        <!-- <i class="fas fa-exclamation common-scan-icon"></i> -->
                                        <p title="Undetected" class="result-service-text">Undetected</p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                    <table class="table">
                        <tr>
                            <td>
                                <h4 class="property__heading">Basic Properties</h4>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <ul class="property-list" id="property">
                                    <li class="property-item">
                                        <p class="property-detail-item-label">MD5</p>
                                        <p class="property-detail-item-result">6334b7aae727505c99ea661e910715ce</p>
                                    </li>
                                    <li class="property-item">   
                                        <p class="property-detail-item-label">SHA-1</p>
                                        <p class="property-detail-item-result">68b3c851a53877e3edf1ccd0c00975b5491069f3</p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">SHA-256</p>
                                        <p class="property-detail-item-result">
                                            eb37971d9543ced32581a11f616f396ae42fbb90cd71897bd25d3cef9f081d02
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">Vhash</p>
                                        <p class="property-detail-item-result">
                                            f379fc1b93776371448c6c1f7a5a444c
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">SSDEEP</p>
                                        <p class="property-detail-item-result">
                                            384:SYMm+EPbgmJA7buFmLlZQipRAvLyEcDIRaPUXjZqzw85U0x36rsjTLS4oQp:CQbOHuFmLQipgZaczZqB5Fisjvxz
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">TLSH</p>
                                        <p class="property-detail-item-result">
                                            T1A9C2C08DF645F078F4BB917C50AE12E7FA6C4081F706A47689A1821DCDA224B2B57ECD
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">File type</p>
                                        <p class="property-detail-item-result">
                                            Office Open XML Document
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">Magic</p>
                                        <p class="property-detail-item-result">
                                            T1A9C2C08DF645F078F4BB917C50AE12E7FA6C4081F706A47689A1821DCDA224B2B57ECD
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-detail-item-label">TrID</p>
                                        <p class="property-detail-item-result">
                                            T1A9C2C08DF645F078F4BB917C50AE12E7FA6C4081F706A47689A1821DCDA224B2B57ECD
                                        </p>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h4 class="property__heading">History</h4>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <ul class="property-list" id="history">
                                    <li class="property-item">
                                        <p class="property-history-item-label">Creation Time</p>
                                        <p class="property-history-item-result">2014-08-11 17:35:00</p>
                                    </li>
                                    <li class="property-item">   
                                        <p class="property-history-item-label">First Submission</p>
                                        <p class="property-history-item-result">2022-01-07 15:12:49</p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-history-item-label">Last Submission</p>
                                        <p class="property-history-item-result">
                                            2022-01-07 15:12:49
                                        </p>
                                    </li>
                                    <li class="property-item">
                                        <p class="property-history-item-label">Last Analysis</p>
                                        <p class="property-history-item-result">
                                            2022-01-07 15:12:49
                                        </p>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h4 class="property__heading">Names</h4>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <ul class="property-list" id="names">
                                    <li class="property-item">
                                        <p class="property-name-item-result">2014-08-11 17:35:00</p>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const data = JSON.parse('<%- JSON.stringify(result) %>');
    console.log(data);

    // Header number
    const numberIcon = document.querySelector('.file-scan__number-icon-container');
    const numberText = document.querySelector('.number-scan');
    const commonScanText = document.querySelector('.file-common-scan-text');
    const commonScanIcon = document.querySelector('.file-common-scan-icon-container');
    numberText.innerHTML = data.last_analysis_stats.malicious
    commonScanText.innerHTML = `${data.last_analysis_stats.malicious} security vendors`;

    if (data.last_analysis_stats.malicious == 0) {
        numberIcon.innerHTML = `<i class="fas fa-check-double result-scan-icon success"></i>`;
        numberText.classList.add('success-text');
        commonScanText.classList.add('success-text');
        commonScanIcon.innerHTML = `<i class="fas fa-check common-scan-icon success-alt"></i>`;
    }

    // Header file information
    const hashTextHeader = document.querySelector('.hash-text');
    const fileName = document.querySelector('.file-name');
    const fileSizeNumber = document.querySelector('.file-size-number');
    const fileLastAnalyst = document.querySelector('.file-upload-text');
    const tagsHeader = document.querySelector('.tag-list');

    const fileSize = data.size < 1024 ? data.size + ' B' : (data.size/1024).toFixed(2) + ' KB';

    hashTextHeader.innerHTML = data.sha256;
    fileName.innerHTML = data.meaningful_name;
    fileSizeNumber.innerHTML = `${fileSize}`;
    const tagHTML = data.tags.map(tag => {
        return `
            <li class="tag-item">
                <p class="tag">${tag}</p>
            </li>
        `;
    }).join('');
    tagsHeader.innerHTML = tagHTML;
    const dateFileLastAnalystHeader = new Date(data.last_analysis_date*1000).toISOString().replace(/[TZ]/g, ' ').trim();
    fileLastAnalyst.innerHTML = `${dateFileLastAnalystHeader.slice(0, dateFileLastAnalystHeader.length-4)} UTC`;

    // Detection
    const tableServices = document.querySelector('.table-scan-file-result');
    var tableHTML = '';
    var index = 0;
    for (const [service, serviceRes] of Object.entries(data.last_analysis_results)) {
        let icon = '';
        let classColor = '';
        switch (serviceRes.category) {
            case 'malicious':
                icon = '<i class="fas fa-exclamation common-scan-icon"></i>';
                break;
    
            case 'undetected': 
                icon = '<i class="fas fa-check common-scan-icon success-alt"></i>';
                classColor = 'success-text';
                serviceRes.result = 'undetected';
                break;
    
            default:
                icon = '<i class="far fa-eye-slash common-scan-icon unable-process"></i>';
                classColor = 'unable-process-text';
                serviceRes.result = 'Unable to process file type';
                break;
        }
        if (index % 2 == 0) {
            tableHTML += `
                <tr>
                    <td class="service-result__wrapper">
                        <div class="service-result__container">
                            <p class="service-text" id="service-text">${service}</p>
                            <div class="result-serivce" title="${serviceRes.result}">
                                ${icon}
                                <p class="result-service-text ${classColor}">${serviceRes.result}</p>
                            </div>
                        </div>
            `
        } 
        else {
            tableHTML += `
                <div class="service-result__container">
                            <p class="service-text">${service}</p>
                            <div class="result-serivce" title="${serviceRes.result}">
                                ${icon}
                                <p class="result-service-text ${classColor}">${serviceRes.result}</p>
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }
        index ++;
    }

    tableServices.innerHTML = tableHTML;

    /** Details **/
    // Properties
    const propertyLists = document.querySelector('#property');
    const properties = [
        'md5',
        'sha1',
        'sha256',
        'tlsh',
        'vhash',
        'trid',
        'type_description',
        'magic',
        'ssdeep',
        'size'
    ];

    const propertyHTML = properties.map(property => {
        if (property === 'size') {
            data[property] = fileSize;
        }
        return `
            <li class="property-item">
                <p class="property-detail-item-label">${property.toUpperCase()}</p>
                <p class="property-detail-item-result">${data[property]}</p>
            </li>
        `;
    }).join('');
    propertyLists.innerHTML = propertyHTML;

    // History
    const historyTimeList = document.querySelector('#history')
    const history = [
        {
            label: 'Creation Time',
            key: 'creation_date'
        },
        {
            label: 'Last Analysis',
            key: 'last_analysis_date'
        },
        {
            label: 'First Submission',
            key: 'first_submission_date'
        },
        {
            label: 'Last Submission',
            key: 'last_submission_date'
        },
    ];

    const historyHTML = history.map(time => {
        const timeHistory = new Date(data[time.key]*1000).toISOString().replace(/[TZ]/g, ' ').trim();
        return  `
            <li class="property-item">
                <p class="property-history-item-label">${time.label}</p>
                <p class="property-history-item-result">${timeHistory.slice(0, timeHistory.length-4)} UTC </p>
            </li>
        `;
    }).join('');
    historyTimeList.innerHTML = historyHTML;

    // Name
    const namesList = document.querySelector('#names');
    const namesHTML = data.names.map(name => {
        return  `
            <li class="property-item">
                <p class="property-name-item-result">${name}</p>
            </li>
        `;
    }).join('');

    namesList.innerHTML = namesHTML;

</script>